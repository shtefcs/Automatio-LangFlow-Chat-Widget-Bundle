(()=>{var Ue=Object.create;var ae=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Ye=Object.getPrototypeOf,Xe=Object.prototype.hasOwnProperty;var Qe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ze=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of We(e))!Xe.call(t,i)&&i!==n&&ae(t,i,{get:()=>e[i],enumerable:!(r=Ve(e,i))||r.enumerable});return t};var Je=(t,e,n)=>(n=t!=null?Ue(Ye(t)):{},Ze(e||!t||!t.__esModule?ae(n,"default",{value:t,enumerable:!0}):n,t));var me=Qe((xt,pe)=>{pe.exports=React});var ge=Qe((St,ye)=>{ye.exports=ReactDOM});var $=(t=>(t.CONNECTING="CONNECTING",t.CONNECTED="CONNECTED",t.DISCONNECTED="DISCONNECTED",t))($||{});var z=class{constructor(){this.listeners=new Map}on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}off(e,n){if(!this.listeners.has(e))return;let r=this.listeners.get(e);r.length>1?this.listeners.set(e,r.filter(i=>i!==n)):this.listeners.delete(e)}emit(e,...n){if(!this.listeners.has(e))return;let r=this.listeners.get(e);for(let i of r)i(...n)}};var K=class extends z{constructor(e,n){super();this.baseURL=e;this.apiKey=n;this.status="DISCONNECTED";this.messageQueue=[];this.processingQueue=!1;this.currentController=null;this.retryCount=0;this.maxRetries=3;this.retryDelay=1e3}async connect(){if(this.status==="CONNECTING"||this.status==="CONNECTED")return;this.status="CONNECTING",this.emit("statusChange",this.status);try{await this.testConnection(),this.status="CONNECTED",this.emit("statusChange",this.status),this.processMessageQueue()}catch(e){console.error("Connection failed:",e),this.status="DISCONNECTED",this.emit("statusChange",this.status),this.retryConnection()}}async testConnection(){let e=new AbortController,n=new Headers;n.append("Content-Type","application/json"),n.append("apikey",this.apiKey);try{let r=await fetch(`${this.baseURL}/health`,{method:"GET",headers:n,signal:e.signal});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let i=await r.json();return console.log("Health check response:",i),i}catch(r){throw console.error("Health check failed:",r),r}finally{e.abort()}}async disconnect(){this.status="DISCONNECTED",this.emit("statusChange",this.status),this.currentController&&(this.currentController.abort(),this.currentController=null)}retryConnection(){this.retryCount<this.maxRetries?(this.retryCount++,setTimeout(()=>{this.connect()},this.retryDelay*this.retryCount)):(console.error("Max retry attempts reached"),this.emit("error",new Error("Failed to establish connection after maximum retry attempts")))}async sendMessage(e,n={}){if(this.status!=="CONNECTED"){this.messageQueue.push({message:e,options:n});return}this.messageQueue.push({message:e,options:n}),this.processMessageQueue()}async processMessageQueue(){if(this.processingQueue||this.messageQueue.length===0)return;this.processingQueue=!0;let e=this.messageQueue.shift();if(!e){this.processingQueue=!1;return}this.currentController=new AbortController;let n=new Headers;n.append("Content-Type","application/json"),n.append("apikey",this.apiKey);try{let r=await fetch(`${this.baseURL}/chat/completions`,{method:"POST",headers:n,body:JSON.stringify({messages:[{role:"user",content:e.message}]}),signal:this.currentController.signal});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let i=await r.json();this.emit("message",i)}catch(r){r.name==="AbortError"?console.log("Request was aborted"):this.emit("error",r)}finally{this.currentController=null,this.processingQueue=!1,this.processMessageQueue()}}};var Y=me();var X=ge();var Q={chat:{backgroundColor:"#ffffff",borderRadius:"10px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",fontFamily:"Arial, sans-serif",maxWidth:"400px",margin:"20px",padding:"20px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},title:{fontSize:"1.2em",fontWeight:"bold",margin:0},closeButton:{background:"none",border:"none",cursor:"pointer",fontSize:"1.2em",padding:"5px"},messageContainer:{height:"300px",overflowY:"auto",marginBottom:"20px",padding:"10px",border:"1px solid #e0e0e0",borderRadius:"5px"},message:{marginBottom:"10px",padding:"8px",borderRadius:"5px",maxWidth:"80%"},userMessage:{backgroundColor:"#007bff",color:"#ffffff",alignSelf:"flex-end",marginLeft:"auto"},botMessage:{backgroundColor:"#f0f0f0",color:"#000000"},inputContainer:{display:"flex",gap:"10px"},input:{flex:1,padding:"8px",borderRadius:"5px",border:"1px solid #e0e0e0"},sendButton:{padding:"8px 15px",backgroundColor:"#007bff",color:"#ffffff",border:"none",borderRadius:"5px",cursor:"pointer"},error:{color:"red",marginTop:"10px"},statusIndicator:{width:"10px",height:"10px",borderRadius:"50%",display:"inline-block",marginRight:"5px"},connected:{backgroundColor:"#28a745"},connecting:{backgroundColor:"#ffc107"},disconnected:{backgroundColor:"#dc3545"}};var Z=({status:t})=>{let e={CONNECTED:"connected",CONNECTING:"connecting",DISCONNECTED:"disconnected"}[t]||"disconnected";return Y.createElement("div",{style:{...Q.statusIndicator,...Q[e]}})};var J=({messages:t,onClose:e,onSendMessage:n,status:r})=>{let[i,s]=Y.useState(""),o=Y.useRef(null),c=()=>{i.trim()&&(n(i),s(""))},a=d=>{d.key==="Enter"&&c()};return Y.useEffect(()=>{var d;(d=o.current)==null||d.scrollTo(0,o.current.scrollHeight)},[t]),Y.createElement("div",{style:Q.chat},Y.createElement("div",{style:Q.header},Y.createElement(Z,{status:r}),Y.createElement("h2",{style:Q.title},"Chat"),Y.createElement("button",{style:Q.closeButton,onClick:e},"Ã—")),Y.createElement("div",{style:Q.messageContainer,ref:o},t.map((d,u)=>Y.createElement("div",{key:u,style:{...Q.message,...d.role==="user"?Q.userMessage:Q.botMessage}},d.content))),Y.createElement("div",{style:Q.inputContainer},Y.createElement("input",{type:"text",style:Q.input,value:i,onChange:d=>s(d.target.value),onKeyPress:a,placeholder:"Type your message..."}),Y.createElement("button",{style:Q.sendButton,onClick:c},"Send")))};var ee=class{constructor(e,n,r){this.containerId=e;this.client=new K(n,r);this.messages=[];this.container=null;this.initialize()}initialize(){if(this.container=document.getElementById(this.containerId),!this.container){console.error(`Container with id '${this.containerId}' not found`);return}this.client.on("message",e=>{this.messages.push({role:"assistant",content:e.choices[0].message.content}),this.render()}),this.client.on("error",e=>{console.error("Error:",e)}),this.client.connect(),this.render()}handleSendMessage(e){this.messages.push({role:"user",content:e}),this.client.sendMessage(e),this.render()}handleClose(){this.client.disconnect(),this.container&&(X.unmountComponentAtNode(this.container),this.container.remove())}render(){this.container&&X.render(Y.createElement(J,{messages:this.messages,onClose:()=>this.handleClose(),onSendMessage:e=>this.handleSendMessage(e),status:this.client.status}),this.container)}};window.ChatWidget=ee;})();
